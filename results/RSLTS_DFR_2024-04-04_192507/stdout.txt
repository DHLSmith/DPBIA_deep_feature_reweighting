C:\deep_learning_project\DPBIA_deep_feature_reweighting\venv\Scripts\python.exe C:\deep_learning_project\DPBIA_deep_feature_reweighting\dfr_evaluate_spurious.py --data_dir=../data/waterbird_complete95_forest2water2/ --output_dir=RSLTS_DFR --ckpt_path=RSLTS_TC_2024-03-21_100243/final_checkpoint.pt --tune_class_weights_dfr_train
Preparing directory RSLTS_DFR_2024-04-04_192507
# load trainset
11788
4795
# load testset
11788
5794
# load valset
11788
1199
# Load model
C:\deep_learning_project\DPBIA_deep_feature_reweighting\venv\Lib\site-packages\torchvision\models\_utils.py:208: UserWarning: The parameter 'pretrained' is deprecated since 0.13 and may be removed in the future, please use 'weights' instead.
  warnings.warn(
C:\deep_learning_project\DPBIA_deep_feature_reweighting\venv\Lib\site-packages\torchvision\models\_utils.py:223: UserWarning: Arguments other than a weight enum or `None` for 'weights' are deprecated since 0.13 and may be removed in the future. The current behavior is equivalent to passing `weights=None`.
  warnings.warn(msg)
  0%|          | 0/58 [00:00<?, ?it/s]Base Model
100%|██████████| 58/58 [00:37<00:00,  1.56it/s]
100%|██████████| 12/12 [00:22<00:00,  1.84s/it]
100%|██████████| 48/48 [00:31<00:00,  1.53it/s]

base_model_results={'test': {'accuracy_0_0': 0.9960088691796009, 'accuracy_0_1': 0.8527716186252772, 'accuracy_1_0': 0.7414330218068536, 'accuracy_1_1': 0.9641744548286605, 'mean_accuracy': 0.908526061442872, 'worst_accuracy': 0.7414330218068536}, 'val': {'accuracy_0_0': 0.9978586723768736, 'accuracy_0_1': 0.8347639484978541, 'accuracy_1_0': 0.6992481203007519, 'accuracy_1_1': 0.9548872180451128, 'mean_accuracy': 0.896580483736447, 'worst_accuracy': 0.6992481203007519}, 'train': {'accuracy_0_0': 1.0, 'accuracy_0_1': 1.0, 'accuracy_1_0': 1.0, 'accuracy_1_1': 1.0, 'mean_accuracy': 1.0, 'worst_accuracy': 1.0}}

100%|██████████| 48/48 [00:32<00:00,  1.49it/s]
100%|██████████| 58/58 [00:33<00:00,  1.75it/s]
100%|██████████| 12/12 [00:23<00:00,  1.96s/it]
DFR on validation TUNE
bin counts for g_train: [70 70 70 70]
Hypers: (0.1, 1.0, 1.0)
DFR on validation EVAL
bin counts of g_train [133 133 133 133]
bin counts of g_train [133 133 133 133]
bin counts of g_train [133 133 133 133]
bin counts of g_train [133 133 133 133]
bin counts of g_train [133 133 133 133]
bin counts of g_train [133 133 133 133]
bin counts of g_train [133 133 133 133]
bin counts of g_train [133 133 133 133]
bin counts of g_train [133 133 133 133]
bin counts of g_train [133 133 133 133]
bin counts of g_train [133 133 133 133]
bin counts of g_train [133 133 133 133]
bin counts of g_train [133 133 133 133]
bin counts of g_train [133 133 133 133]
bin counts of g_train [133 133 133 133]
bin counts of g_train [133 133 133 133]
bin counts of g_train [133 133 133 133]
bin counts of g_train [133 133 133 133]
bin counts of g_train [133 133 133 133]
bin counts of g_train [133 133 133 133]
bin counts of g_test: [2255 2255  642  642]
dfr_val_results={'best_hypers': (0.1, 1.0, 1.0), 'test_accs': [0.9516629711751663, 0.9206208425720621, 0.9392523364485982, 0.942367601246106], 'train_accs': [0.9699248120300752, 0.9323308270676691, 0.9699248120300752, 0.9473684210526315], 'test_worst_acc': 0.9206208425720621, 'test_mean_acc': 0.937176389368312}

DFR on train subsampled
dfr train subset_tune
bin counts for g_train: [56 56 56 56]
c=1.0, class_weight={0: 1, 1: 1.0}, worst_acc=0.8626609442060086, group_accs=array([0.97430407, 0.86266094, 0.91729323, 0.93984962])
c=1.0, class_weight={0: 1, 1: 2.0}, worst_acc=0.8261802575107297, group_accs=array([0.97216274, 0.82618026, 0.92481203, 0.95488722])
c=1.0, class_weight={0: 1, 1: 3.0}, worst_acc=0.8111587982832618, group_accs=array([0.95931478, 0.8111588 , 0.92481203, 0.94736842])
c=1.0, class_weight={0: 1, 1: 10.0}, worst_acc=0.776824034334764, group_accs=array([0.95717345, 0.77682403, 0.92481203, 0.96992481])
c=1.0, class_weight={0: 1, 1: 100.0}, worst_acc=0.6652360515021459, group_accs=array([0.92291221, 0.66523605, 0.96240602, 0.97744361])
c=1.0, class_weight={0: 1, 1: 300.0}, worst_acc=0.5944206008583691, group_accs=array([0.86295503, 0.5944206 , 0.96240602, 0.98496241])
c=1.0, class_weight={0: 1, 1: 1000.0}, worst_acc=0.5579399141630901, group_accs=array([0.85224839, 0.55793991, 0.95488722, 0.98496241])
c=1.0, class_weight={0: 1.0, 1: 1}, worst_acc=0.8562231759656652, group_accs=array([0.97430407, 0.85622318, 0.91729323, 0.93984962])
c=1.0, class_weight={0: 2.0, 1: 1}, worst_acc=0.869098712446352, group_accs=array([0.9764454 , 0.86909871, 0.90977444, 0.93984962])
c=1.0, class_weight={0: 3.0, 1: 1}, worst_acc=0.8776824034334764, group_accs=array([0.98072805, 0.8776824 , 0.89473684, 0.93984962])
c=1.0, class_weight={0: 10.0, 1: 1}, worst_acc=0.8571428571428571, group_accs=array([0.99143469, 0.90987124, 0.85714286, 0.92481203])
c=1.0, class_weight={0: 100.0, 1: 1}, worst_acc=0.8412017167381974, group_accs=array([0.95289079, 0.84120172, 0.93233083, 0.95488722])
c=1.0, class_weight={0: 300.0, 1: 1}, worst_acc=0.7896995708154506, group_accs=array([0.93576017, 0.78969957, 0.94736842, 0.95488722])
c=1.0, class_weight={0: 1000.0, 1: 1}, worst_acc=0.7918454935622318, group_accs=array([0.94218415, 0.79184549, 0.95488722, 0.96240602])
c=0.7, class_weight={0: 1, 1: 1.0}, worst_acc=0.8605150214592274, group_accs=array([0.97430407, 0.86051502, 0.92481203, 0.93984962])
c=0.7, class_weight={0: 1, 1: 2.0}, worst_acc=0.8369098712446352, group_accs=array([0.9614561 , 0.83690987, 0.92481203, 0.94736842])
c=0.7, class_weight={0: 1, 1: 3.0}, worst_acc=0.8304721030042919, group_accs=array([0.95931478, 0.8304721 , 0.93233083, 0.95488722])
c=0.7, class_weight={0: 1, 1: 10.0}, worst_acc=0.7725321888412017, group_accs=array([0.94218415, 0.77253219, 0.93984962, 0.96992481])
c=0.7, class_weight={0: 1, 1: 100.0}, worst_acc=0.648068669527897, group_accs=array([0.92505353, 0.64806867, 0.95488722, 0.97744361])
c=0.7, class_weight={0: 1, 1: 300.0}, worst_acc=0.5815450643776824, group_accs=array([0.89721627, 0.58154506, 0.95488722, 0.98496241])
c=0.7, class_weight={0: 1, 1: 1000.0}, worst_acc=0.5643776824034334, group_accs=array([0.85224839, 0.56437768, 0.97744361, 0.98496241])
c=0.7, class_weight={0: 1.0, 1: 1}, worst_acc=0.851931330472103, group_accs=array([0.97002141, 0.85193133, 0.92481203, 0.93984962])
c=0.7, class_weight={0: 2.0, 1: 1}, worst_acc=0.8733905579399142, group_accs=array([0.98286938, 0.87339056, 0.90225564, 0.93984962])
c=0.7, class_weight={0: 3.0, 1: 1}, worst_acc=0.8733905579399142, group_accs=array([0.98501071, 0.87339056, 0.88721805, 0.93233083])
c=0.7, class_weight={0: 10.0, 1: 1}, worst_acc=0.8646616541353384, group_accs=array([0.98929336, 0.91845494, 0.86466165, 0.92481203])
c=0.7, class_weight={0: 100.0, 1: 1}, worst_acc=0.8133047210300429, group_accs=array([0.95074946, 0.81330472, 0.93233083, 0.94736842])
c=0.7, class_weight={0: 300.0, 1: 1}, worst_acc=0.7939914163090128, group_accs=array([0.95074946, 0.79399142, 0.92481203, 0.96240602])
c=0.7, class_weight={0: 1000.0, 1: 1}, worst_acc=0.7854077253218884, group_accs=array([0.94432548, 0.78540773, 0.94736842, 0.95488722])
c=0.3, class_weight={0: 1, 1: 1.0}, worst_acc=0.851931330472103, group_accs=array([0.97002141, 0.85193133, 0.92481203, 0.93984962])
c=0.3, class_weight={0: 1, 1: 2.0}, worst_acc=0.8326180257510729, group_accs=array([0.96359743, 0.83261803, 0.92481203, 0.94736842])
c=0.3, class_weight={0: 1, 1: 3.0}, worst_acc=0.8090128755364807, group_accs=array([0.95717345, 0.80901288, 0.92481203, 0.95488722])
c=0.3, class_weight={0: 1, 1: 10.0}, worst_acc=0.7725321888412017, group_accs=array([0.92933619, 0.77253219, 0.96240602, 0.96992481])
c=0.3, class_weight={0: 1, 1: 100.0}, worst_acc=0.6244635193133047, group_accs=array([0.91648822, 0.62446352, 0.96240602, 0.97744361])
c=0.3, class_weight={0: 1, 1: 300.0}, worst_acc=0.6223175965665236, group_accs=array([0.89079229, 0.6223176 , 0.95488722, 0.98496241])
c=0.3, class_weight={0: 1, 1: 1000.0}, worst_acc=0.5429184549356223, group_accs=array([0.86295503, 0.54291845, 0.96240602, 0.98496241])
c=0.3, class_weight={0: 1.0, 1: 1}, worst_acc=0.8454935622317596, group_accs=array([0.96359743, 0.84549356, 0.92481203, 0.93984962])
c=0.3, class_weight={0: 2.0, 1: 1}, worst_acc=0.8755364806866953, group_accs=array([0.9764454 , 0.87553648, 0.89473684, 0.93233083])
c=0.3, class_weight={0: 3.0, 1: 1}, worst_acc=0.8862660944206009, group_accs=array([0.9764454 , 0.88626609, 0.88721805, 0.93233083])
c=0.3, class_weight={0: 10.0, 1: 1}, worst_acc=0.849624060150376, group_accs=array([0.99143469, 0.92703863, 0.84962406, 0.92481203])
c=0.3, class_weight={0: 100.0, 1: 1}, worst_acc=0.8583690987124464, group_accs=array([0.95717345, 0.8583691 , 0.91729323, 0.94736842])
c=0.3, class_weight={0: 300.0, 1: 1}, worst_acc=0.8497854077253219, group_accs=array([0.95931478, 0.84978541, 0.91729323, 0.93984962])
c=0.3, class_weight={0: 1000.0, 1: 1}, worst_acc=0.8047210300429185, group_accs=array([0.94860814, 0.80472103, 0.93233083, 0.96992481])
c=0.1, class_weight={0: 1, 1: 1.0}, worst_acc=0.8390557939914163, group_accs=array([0.95289079, 0.83905579, 0.92481203, 0.94736842])
c=0.1, class_weight={0: 1, 1: 2.0}, worst_acc=0.778969957081545, group_accs=array([0.92505353, 0.77896996, 0.95488722, 0.96992481])
c=0.1, class_weight={0: 1, 1: 3.0}, worst_acc=0.7532188841201717, group_accs=array([0.90792291, 0.75321888, 0.95488722, 0.96992481])
c=0.1, class_weight={0: 1, 1: 10.0}, worst_acc=0.6909871244635193, group_accs=array([0.88865096, 0.69098712, 0.96240602, 0.96992481])
c=0.1, class_weight={0: 1, 1: 100.0}, worst_acc=0.5987124463519313, group_accs=array([0.90149893, 0.59871245, 0.96240602, 0.97744361])
c=0.1, class_weight={0: 1, 1: 300.0}, worst_acc=0.5429184549356223, group_accs=array([0.88008565, 0.54291845, 0.96992481, 0.9924812 ])
c=0.1, class_weight={0: 1, 1: 1000.0}, worst_acc=0.5042918454935622, group_accs=array([0.85438972, 0.50429185, 0.96992481, 0.9924812 ])
c=0.1, class_weight={0: 1.0, 1: 1}, worst_acc=0.8369098712446352, group_accs=array([0.94860814, 0.83690987, 0.93233083, 0.93984962])
c=0.1, class_weight={0: 2.0, 1: 1}, worst_acc=0.8733905579399142, group_accs=array([0.9764454 , 0.87339056, 0.92481203, 0.93233083])
c=0.1, class_weight={0: 3.0, 1: 1}, worst_acc=0.8969957081545065, group_accs=array([0.98072805, 0.89699571, 0.90225564, 0.92481203])
c=0.1, class_weight={0: 10.0, 1: 1}, worst_acc=0.8421052631578947, group_accs=array([0.98929336, 0.93562232, 0.84210526, 0.92481203])
c=0.1, class_weight={0: 100.0, 1: 1}, worst_acc=0.7518796992481203, group_accs=array([0.99571734, 0.96781116, 0.7518797 , 0.90225564])
c=0.1, class_weight={0: 300.0, 1: 1}, worst_acc=0.8776824034334764, group_accs=array([0.96573876, 0.8776824 , 0.91729323, 0.93233083])
c=0.1, class_weight={0: 1000.0, 1: 1}, worst_acc=0.8326180257510729, group_accs=array([0.95503212, 0.83261803, 0.92481203, 0.94736842])
c=0.07, class_weight={0: 1, 1: 1.0}, worst_acc=0.796137339055794, group_accs=array([0.9143469 , 0.79613734, 0.95488722, 0.94736842])
c=0.07, class_weight={0: 1, 1: 2.0}, worst_acc=0.740343347639485, group_accs=array([0.88865096, 0.74034335, 0.96240602, 0.96992481])
c=0.07, class_weight={0: 1, 1: 3.0}, worst_acc=0.7060085836909872, group_accs=array([0.88436831, 0.70600858, 0.96992481, 0.96992481])
c=0.07, class_weight={0: 1, 1: 10.0}, worst_acc=0.6781115879828327, group_accs=array([0.89293362, 0.67811159, 0.96240602, 0.96992481])
c=0.07, class_weight={0: 1, 1: 100.0}, worst_acc=0.6115879828326181, group_accs=array([0.88436831, 0.61158798, 0.96240602, 0.96992481])
c=0.07, class_weight={0: 1, 1: 300.0}, worst_acc=0.5686695278969958, group_accs=array([0.89507495, 0.56866953, 0.96240602, 0.98496241])
c=0.07, class_weight={0: 1, 1: 1000.0}, worst_acc=0.5064377682403434, group_accs=array([0.86509636, 0.50643777, 0.96992481, 0.9924812 ])
c=0.07, class_weight={0: 1.0, 1: 1}, worst_acc=0.8133047210300429, group_accs=array([0.92291221, 0.81330472, 0.95488722, 0.94736842])
c=0.07, class_weight={0: 2.0, 1: 1}, worst_acc=0.8669527896995708, group_accs=array([0.96573876, 0.86695279, 0.92481203, 0.93233083])
c=0.07, class_weight={0: 3.0, 1: 1}, worst_acc=0.8948497854077253, group_accs=array([0.98072805, 0.89484979, 0.90977444, 0.92481203])
c=0.07, class_weight={0: 10.0, 1: 1}, worst_acc=0.8270676691729323, group_accs=array([0.99143469, 0.94420601, 0.82706767, 0.91729323])
c=0.07, class_weight={0: 100.0, 1: 1}, worst_acc=0.706766917293233, group_accs=array([0.99785867, 0.96995708, 0.70676692, 0.87969925])
c=0.07, class_weight={0: 300.0, 1: 1}, worst_acc=0.8819742489270386, group_accs=array([0.97002141, 0.88197425, 0.90977444, 0.93984962])
c=0.07, class_weight={0: 1000.0, 1: 1}, worst_acc=0.8154506437768241, group_accs=array([0.94218415, 0.81545064, 0.95488722, 0.96240602])
c=0.03, class_weight={0: 1, 1: 1.0}, worst_acc=0.7188841201716738, group_accs=array([0.82012848, 0.71888412, 0.97744361, 0.96240602])
c=0.03, class_weight={0: 1, 1: 2.0}, worst_acc=0.7145922746781116, group_accs=array([0.8608137 , 0.71459227, 0.96992481, 0.96992481])
c=0.03, class_weight={0: 1, 1: 3.0}, worst_acc=0.7296137339055794, group_accs=array([0.875803  , 0.72961373, 0.96240602, 0.96240602])
c=0.03, class_weight={0: 1, 1: 10.0}, worst_acc=0.6695278969957081, group_accs=array([0.89293362, 0.6695279 , 0.94736842, 0.96992481])
c=0.03, class_weight={0: 1, 1: 100.0}, worst_acc=0.5600858369098712, group_accs=array([0.90578158, 0.56008584, 0.96240602, 0.97744361])
c=0.03, class_weight={0: 1, 1: 300.0}, worst_acc=0.5450643776824035, group_accs=array([0.88865096, 0.54506438, 0.95488722, 0.9924812 ])
c=0.03, class_weight={0: 1, 1: 1000.0}, worst_acc=0.5515021459227468, group_accs=array([0.87366167, 0.55150215, 0.97744361, 0.9924812 ])
c=0.03, class_weight={0: 1.0, 1: 1}, worst_acc=0.7253218884120172, group_accs=array([0.82441113, 0.72532189, 0.97744361, 0.95488722])
c=0.03, class_weight={0: 2.0, 1: 1}, worst_acc=0.8390557939914163, group_accs=array([0.94218415, 0.83905579, 0.93984962, 0.94736842])
c=0.03, class_weight={0: 3.0, 1: 1}, worst_acc=0.8991416309012875, group_accs=array([0.96788009, 0.89914163, 0.91729323, 0.92481203])
c=0.03, class_weight={0: 10.0, 1: 1}, worst_acc=0.7969924812030075, group_accs=array([0.99357602, 0.96351931, 0.79699248, 0.89473684])
c=0.03, class_weight={0: 100.0, 1: 1}, worst_acc=0.6616541353383458, group_accs=array([1.        , 0.972103  , 0.66165414, 0.85714286])
c=0.03, class_weight={0: 300.0, 1: 1}, worst_acc=0.631578947368421, group_accs=array([0.99785867, 0.9806867 , 0.63157895, 0.84210526])
c=0.03, class_weight={0: 1000.0, 1: 1}, worst_acc=0.8969957081545065, group_accs=array([0.97216274, 0.89699571, 0.90977444, 0.93233083])
c=0.01, class_weight={0: 1, 1: 1.0}, worst_acc=0.7103004291845494, group_accs=array([0.82226981, 0.71030043, 0.95488722, 0.96992481])
c=0.01, class_weight={0: 1, 1: 2.0}, worst_acc=0.740343347639485, group_accs=array([0.875803  , 0.74034335, 0.93984962, 0.95488722])
c=0.01, class_weight={0: 1, 1: 3.0}, worst_acc=0.7339055793991416, group_accs=array([0.87794433, 0.73390558, 0.93984962, 0.95488722])
c=0.01, class_weight={0: 1, 1: 10.0}, worst_acc=0.6866952789699571, group_accs=array([0.89721627, 0.68669528, 0.93984962, 0.97744361])
c=0.01, class_weight={0: 1, 1: 100.0}, worst_acc=0.5493562231759657, group_accs=array([0.90578158, 0.54935622, 0.94736842, 0.97744361])
c=0.01, class_weight={0: 1, 1: 300.0}, worst_acc=0.4957081545064378, group_accs=array([0.88008565, 0.49570815, 0.95488722, 0.9924812 ])
c=0.01, class_weight={0: 1, 1: 1000.0}, worst_acc=0.41630901287553645, group_accs=array([0.88008565, 0.41630901, 0.95488722, 0.98496241])
c=0.01, class_weight={0: 1.0, 1: 1}, worst_acc=0.7103004291845494, group_accs=array([0.82226981, 0.71030043, 0.95488722, 0.96992481])
c=0.01, class_weight={0: 2.0, 1: 1}, worst_acc=0.6745182012847966, group_accs=array([0.6745182 , 0.69098712, 0.97744361, 0.96240602])
c=0.01, class_weight={0: 3.0, 1: 1}, worst_acc=0.6909871244635193, group_accs=array([0.70021413, 0.69098712, 0.97744361, 0.96240602])
c=0.01, class_weight={0: 10.0, 1: 1}, worst_acc=0.7368421052631579, group_accs=array([0.99571734, 0.972103  , 0.73684211, 0.85714286])
c=0.01, class_weight={0: 100.0, 1: 1}, worst_acc=0.45864661654135336, group_accs=array([1.        , 0.99570815, 0.45864662, 0.59398496])
c=0.01, class_weight={0: 300.0, 1: 1}, worst_acc=0.45112781954887216, group_accs=array([1.        , 0.99570815, 0.45112782, 0.57142857])
c=0.01, class_weight={0: 1000.0, 1: 1}, worst_acc=0.6015037593984962, group_accs=array([0.99785867, 0.98712446, 0.60150376, 0.7593985 ])
Hypers: (0.03, 3.0, 1)
dfr train subset eval
bin counts for g_train: [56 56 56 56]
bin counts for g_train: [56 56 56 56]
bin counts for g_train: [56 56 56 56]
bin counts for g_train: [56 56 56 56]
bin counts for g_train: [56 56 56 56]
bin counts for g_train: [56 56 56 56]
bin counts for g_train: [56 56 56 56]
bin counts for g_train: [56 56 56 56]
bin counts for g_train: [56 56 56 56]
bin counts for g_train: [56 56 56 56]

dfr_train_results={'best_hypers': (0.03, 3.0, 1), 'test_accs': [0.9707317073170731, 0.9095343680709534, 0.926791277258567, 0.9454828660436138], 'train_accs': [0.9821428571428571, 1.0, 1.0, 1.0], 'test_worst_acc': 0.9095343680709534, 'test_mean_acc': 0.9392474974111149}

all_results={'base_model_results': {'test': {'accuracy_0_0': 0.9960088691796009, 'accuracy_0_1': 0.8527716186252772, 'accuracy_1_0': 0.7414330218068536, 'accuracy_1_1': 0.9641744548286605, 'mean_accuracy': 0.908526061442872, 'worst_accuracy': 0.7414330218068536}, 'val': {'accuracy_0_0': 0.9978586723768736, 'accuracy_0_1': 0.8347639484978541, 'accuracy_1_0': 0.6992481203007519, 'accuracy_1_1': 0.9548872180451128, 'mean_accuracy': 0.896580483736447, 'worst_accuracy': 0.6992481203007519}, 'train': {'accuracy_0_0': 1.0, 'accuracy_0_1': 1.0, 'accuracy_1_0': 1.0, 'accuracy_1_1': 1.0, 'mean_accuracy': 1.0, 'worst_accuracy': 1.0}}, 'dfr_val_results': {'best_hypers': (0.1, 1.0, 1.0), 'test_accs': [0.9516629711751663, 0.9206208425720621, 0.9392523364485982, 0.942367601246106], 'train_accs': [0.9699248120300752, 0.9323308270676691, 0.9699248120300752, 0.9473684210526315], 'test_worst_acc': 0.9206208425720621, 'test_mean_acc': 0.937176389368312}, 'dfr_train_results': {'best_hypers': (0.03, 3.0, 1), 'test_accs': [0.9707317073170731, 0.9095343680709534, 0.926791277258567, 0.9454828660436138], 'train_accs': [0.9821428571428571, 1.0, 1.0, 1.0], 'test_worst_acc': 0.9095343680709534, 'test_mean_acc': 0.9392474974111149}}

Process finished with exit code 0
